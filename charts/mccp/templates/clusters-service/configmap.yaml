apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "mccp.fullname" . }}-cluster-service
  namespace: {{ .Release.Namespace }}
data:
  CLUSTER_NAME: {{ .Values.config.cluster.name }}
  GIT_PROVIDER_TYPE: {{ .Values.config.git.type }}
  GIT_PROVIDER_HOSTNAME: {{ .Values.config.git.hostname }}
  CAPI_CLUSTERS_NAMESPACE: {{ .Values.config.capi.clusters.namespace }}
  CAPI_TEMPLATES_NAMESPACE: {{ .Values.config.capi.templates.namespace }}
  INJECT_PRUNE_ANNOTATION: {{ .Values.config.capi.templates.injectPruneAnnotation }}
  CAPI_TEMPLATES_REPOSITORY_URL: {{ .Values.config.capi.repositoryURL | quote }}
  CAPI_REPOSITORY_PATH: {{ .Values.config.capi.repositoryPath | quote }}
  CAPI_TEMPLATES_REPOSITORY_API_URL: {{ .Values.config.capi.repositoryApiURL | quote }}
  CAPI_TEMPLATES_REPOSITORY_BASE_BRANCH: {{ .Values.config.capi.baseBranch | quote }}
  {{- if not .Values.config.checkpoint.enabled }}
  CHECKPOINT_DISABLE: 1
  {{- end }}
  {{- if .Values.config.oidc.enabled }}
  WEAVE_GITOPS_AUTH_ENABLED: "true"
  OIDC_ISSUER_URL: {{ .Values.config.oidc.issuerURL | quote }}
  OIDC_REDIRECT_URL: {{ .Values.config.oidc.redirectURL | quote }}
  OIDC_COOKIE_DURATION: {{ .Values.config.oidc.cookieDuration | quote }}
  {{- end }}
  NO_TLS: {{ not .Values.tls.enabled | quote }}
  {{- if and .Values.tls.enabled .Values.tls.secretName }}
  TLS_CERT_FILE: /etc/clusters-service-tls/tls.crt
  TLS_PRIVATE_KEY: /etc/clusters-service-tls/tls.key
  {{- end }}